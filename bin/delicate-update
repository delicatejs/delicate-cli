#!/usr/bin/env node

const download = require('download-git-repo')
const program = require('commander')
const fs = require('fs-extra')
const path = require('path')
const ora = require('ora')
const chalk = require('chalk')
const rm = require('rimraf').sync
const checkVersion = require('../lib/check-version')

program.on('--help', () => {
  console.log('  Examples:')
  console.log()
  console.log('    $ delicate update')
  console.log()
})

console.log()
process.on('exit', () => {
  console.log()
})

checkVersion(() => {
  downloadDelicate()
})

// ä¸‹è½½ä»“åº“åœ°å€
function downloadDelicate() {
  const spinner = ora(`update delicate`)
  spinner.start()
  
  const rawName = path.join(process.cwd(), './.delicate')  
  //ç›®å½•å­˜åœ¨åˆ™å…ˆåˆ é™¤
	rm(rawName)

  //å»githubå…‹éš†
  download('delicatejs/delicatejs', rawName, { clone: false }, err => {
    spinner.stop()
    rm(path.join(process.cwd(), 'system'))     
    fs.moveSync(path.join(rawName, 'system'), path.join(process.cwd(), 'system'))  
    rm(rawName)
    console.log(`--------------------${chalk.green('update success')}--------------------`)
    console.log()
    console.log(chalk.yellow('ğŸ¤ å¦‚æœæœ‰æ–°çš„ä¾èµ–ï¼Œè¯·åœ¨å¯åŠ¨æœåŠ¡æ—¶ï¼Œæ ¹æ®é”™è¯¯æç¤ºè‡ªè¡Œå®‰è£…ä¾èµ–æ¨¡å—'))
  })
}
